!function(t){function e(s){if(i[s])return i[s].exports;var r=i[s]={exports:{},id:s,loaded:!1};return t[s].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){var s=i(1);AFRAME.registerSystem("clubbers",{schema:{src:{type:"selector","default":null},size:{"default":2048},mute:{"default":!1},lowRange:{type:"array","default":[10,32]},midRange:{type:"array","default":[32,48]},highRange:{type:"array","default":[48,128]},lowSmooth:{type:"array","default":[.1,.1,.1,.16]},midSmooth:{type:"array","default":[.1,.1,.1,.16]},highSmooth:{type:"array","default":[.1,.1,.1,.16]}},init:function(){var t=this.data;this.clubber=new s({src:this.data.src,size:this.data.size,mute:this.data.mute}),this.clubber.listen(t.src),this.low=this.clubber.band({from:t.lowRange[0],to:t.lowRange[1],smooth:t.lowSmooth}),this.mid=this.clubber.band({from:t.midRange[0],to:t.midRange[1],smooth:t.midSmooth}),this.high=this.clubber.band({from:t.highRange[0],to:t.highRange[1],smooth:t.highSmooth})},updateClubber:function(t){t!==this.lastTime&&(this.clubber.update(t),this.lastTime=t)}}),AFRAME.registerComponent("clubber",{schema:{exec:{type:"string","default":null},debug:{"default":!1}},update:function(){var t=["var val;","var mesh = this.getObject3D('mesh');"];if(this.data.exec){var e=this.data.exec.split("#");if(e.length){var i=[],s=0;e.forEach(function(e,r){var a=e.split("=");if(!(a.length<2)){var o=a.pop();i.push(0),t.push("prev = values["+s+"];"),t.push("values["+s+"] = prev = "+o+";"),s++,a.forEach(function(i){if(i=i.replace(" ",""),"."===i[0])t.push("mesh"+i+" = prev;");else{var s=i.split("."),r=s.shift().replace(" ","");if("$"===r[0]&&r===i&&1===a.length)return void t.push(["var ",e,";"].join(""));s.length?s.forEach(function(e){e=e.replace(" ",""),t.push("this.setAttribute('"+r+"','"+e+"', prev);")}):t.push("this.setAttribute('"+r+"',prev);")}})}}),this.values=i;var r=t.join("\n");this.data.debug&&console.log(r),this.func=Function("time","values","low","mid","high",r)}}},tick:function(t,e){var i=this.el.sceneEl.systems.clubbers;this.func&&i&&(i.updateClubber(t),this.func.call(this.el,t,this.values,i.low(),i.mid(),i.high()))}})},function(module,exports){var Clubber=function(config){function freq2midi(freq){var r=1.05946309436,lala=523.251,notetest=eval(freq),ref=lala,hauteur=1,octave=4,alteration,supinf=0,compteur=0,hautnb=1,noteton,ref1=0,ref2=0,temp,flag=0,nmidi=72;for(tableau=new Array;notetest<ref;)ref=Math.floor(1e3*ref/r)/1e3,compteur+=1,supinf=-1,flag=1,ref1=ref;for(;notetest>ref;)ref=Math.floor(1e3*ref*r)/1e3,compteur-=1,supinf=1,ref2=ref;for(Math.abs(notetest-ref1)<Math.abs(notetest-ref2)?(supinf=-1,compteur+=1):1==flag&&(supinf=-1),0==ref1&&(ref1=Math.floor(1e3*ref/r)/1e3,Math.abs(notetest-ref1)<Math.abs(notetest-ref2)&&(compteur+=1,supinf=1)),compteur=Math.abs(compteur);0!=compteur;)(1==hautnb&&supinf==-1||12==hautnb&&1==supinf)&&(octave+=eval(supinf),1==supinf&&(hautnb=0),supinf==-1&&(hautnb=13)),hautnb+=supinf,nmidi+=supinf,compteur-=1;return nmidi}config||(config={}),this.audioCtx=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.audioCtx.createAnalyser(),this.analyser.fftSize=config.size||2048,this.bufferLength=this.analyser.frequencyBinCount,this.thresholdFactor=config.thresholdFactor||.66,config.mute||this.analyser.connect(this.audioCtx.destination),this.data=new Uint8Array(this.bufferLength),this.keys=new Uint8Array(this.bufferLength),this.notes=new Uint16Array(160),this.thresholds=new Uint8Array(160),this.weights=new Uint8Array(160);for(var i=0,inc=this.audioCtx.sampleRate/2/this.bufferLength;i<this.bufferLength;i++){var freq=(i+.5)*inc,key=freq2midi(freq);this.keys[i]=key,this.weights[key]++}this.count=0};Clubber.prototype.listen=function(t){this.el=t,this.source&&this.source.disconnect(this.analyser),this.source=this.audioCtx.createMediaElementSource(t),this.source.connect(this.analyser)},Clubber.prototype.band=function(t){var e={from:1,to:128,snap:.66,smooth:[.33,.33,.33,.33],step:1e3/60};if(t)for(var i in e)t[i]||(t[i]=e[i]);else t=e;var s={count:0,scope:this,config:t,data:new Float32Array(4)};return function(t){function e(t,e,i){return t=t?t:0,i=Math.min(i,s.config.snap),i<0&&(i=t>e?Math.abs(s.config.snap):-i),i*t+(1-i)*e}if(t)for(var i in s.config)void 0!==t[i]&&(s.config[i]=t[i]);if(t=s.config,s.time>s.scope.time)return s.data;for(var r=t.smooth,a=s.data,o=-1,n=0,h=0,u=0,f=0,l=0,c=t.from;c<t.to;c++){var p=s.scope.notes[c],d=s.scope.thresholds[c];p>d&&(u+=Math.max(0,p-128),f+=c%12,h+=c,l++,p>n&&(o=c,n=p))}void 0===s.time&&(s.time=s.scope.time);for(var m=s.time,b=s.config.step,g=s.scope.time+b;m<=g;m+=b)a[0]=e(o%12/12,a[0],r[0]),a[1]=e((l?f/l:0)/12,a[1],r[1]),a[2]=e(((l?h/l:0)-t.from)/(t.to-t.from),a[2],r[2]),a[3]=e((l?u/l:0)/128,a[3],r[3]);return s.time=m,s.count=s.scope.count,a}},Clubber.prototype.update=function(t,e){e||(this.analyser.getByteFrequencyData(this.data),e=e);for(var i=0;i<this.notes.length;i++)this.notes[i]=0;for(i=0;i<this.keys.length;i++)this.notes[this.keys[i]]+=this.data[i];for(i=0;i<this.notes.length;i++){this.notes[i]/=this.weights[i];var s=this.thresholdFactor;this.thresholds[i]=128+Math.max(Math.min(1,Math.max(s,0))*Math.max(0,this.notes[i]-128),this.thresholds[i]),this.thresholds[i]>128&&this.thresholds[i]--}this.time=void 0!==t?parseFloat(t):window.performance.now(),this.count++},module.exports=Clubber}]);